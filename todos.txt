================================================================================
CreditTimeline (ctview2) - Implementation Roadmap
================================================================================

This file tracks the full implementation timeline for the CreditTimeline app.
Future LLM sessions should read this file to understand what's been done and
what comes next.
It should represent the current status of the project and you must keep this document up to date at all times.

Whenever you complete a task in this list you must mark it as completed with a x in the box.
When an entire phase is completed mark the phase as completed in the phase heading. 
The user will move the completed tasks to todos-completed.txt (do not consume this document unless you require historical context on why something was done)

Whenever designing or implementing features or functionality or bug fixes the below ADRs must be respected and complied with.
================================================================================
ARCHITECTURE DECISIONS
================================================================================

AD-001: TypeScript full-stack with SvelteKit
  - Single language across backend and frontend
  - SvelteKit serves both API routes and UI from one process
  - adapter-node for Docker deployment

AD-002: Drizzle ORM with SQLite (better-sqlite3)
  - SQLite as the storage backend via better-sqlite3
  - Schema-as-code matches spec SQL DDL exactly

AD-003: Ajv for JSON Schema validation
  - Draft 2020-12 with cross-file $ref support
  - Compiled validator for fast repeated validation
  - Two schema files: main schema + enums

AD-004: pnpm monorepo with two packages
  - @ctview/core: pure TS library (no web deps)
  - @ctview/web: SvelteKit application
  - Core can be imported by future CLI tools

AD-005: Single Docker container
  - SQLite volume mount for data persistence
  - Multi-stage build for small image size

AD-006: No authentication by default
  - Personal vault, network-level access control
  - Optional INGEST_API_KEY for ingestion endpoint
  - CSRF via SvelteKit's built-in origin checking

AD-007: API-first design for external client support
  - SvelteKit API routes are the canonical interface for all data operations
  - All /api/v1/* routes MUST return JSON and work for any HTTP client (mobile
    apps, CLI tools, third-party integrations, browser fetch)
  - The full container (including frontend) is the deployment unit — external
    clients connect to the same running instance
  - CORS must be configurable so cross-origin clients can call the API
  - All API routes must have consistent error response shapes, proper HTTP
    status codes, and be documented via OpenAPI spec
  - API versioning via URL prefix (/api/v1/) is already in place — maintain
    this convention for all future endpoints
  - SvelteKit page load functions (+page.server.ts) should call the same query
    logic that API routes use, ensuring feature parity between the UI and
    external consumers. Shared query functions should live in @ctview/core or
    a shared lib, not be duplicated between page loads and API routes
  - Future: a lightweight @ctview/sdk package can wrap the HTTP API for
    TypeScript consumers

AD-008: Zod for runtime validation at system boundaries
  - Ajv handles JSON Schema validation of credit file payloads (AD-003)
  - Zod handles everything else at runtime boundaries:
    - Environment variable parsing and validation at startup
    - API request body/query parameter validation
    - Configuration object shapes
    - Response type narrowing
  - This dual-validation approach gives the best of both worlds:
    - Ajv for spec-compliant schema validation (JSON Schema draft 2020-12)
    - Zod for ergonomic TypeScript-native validation with inference




================================================================================
PHASE 8: REMOVE POSTGRES REFERENCES (COMPLETED)
================================================================================

[x] Remove DATABASE_DIALECT from config, Docker, and .env.example
[x] Delete docker-compose.postgres.yml
[x] Remove Postgres sections from README.md and CLAUDE.md files
[x] Update ADRs (AD-002, AD-005) to reflect SQLite-only design
[x] Rename dbDialect → dbEngine in settings query, types, and UI

================================================================================
PHASE 9: POLISH & PRODUCTION
================================================================================

[ ] API documentation — OpenAPI spec (AD-007)
    [ ] Generate an OpenAPI 3.1 specification for all /api/v1/* routes
    [ ] Options for generation:
        - Manual: maintain a spec/openapi.yaml file updated as routes change
        - Auto: use a library to generate spec from route definitions (e.g.
          sveltekit-openapi or a custom Zod-to-OpenAPI pipeline)
    [ ] Serve the OpenAPI spec at GET /api/v1/openapi.json
    [ ] Optionally serve Swagger UI or Scalar at /api/docs for interactive
        API exploration
    [ ] The spec should be accurate enough that external clients can generate
        typed client code from it

[ ] Client SDK package (AD-007)
    [ ] Create @ctview/sdk package in the monorepo
    [ ] Lightweight TypeScript HTTP client wrapping all /api/v1/* endpoints
    [ ] Type-safe request/response types (shared with or generated from the
        API's Zod schemas)
    [ ] Zero runtime dependencies beyond fetch (works in Node, browser, Deno)
    [ ] Publish as npm package (or just use via workspace dependency)
    [ ] This enables external TypeScript consumers to integrate without
        hand-crafting HTTP calls

[ ] Authentication (optional, for multi-user households)
[ ] Data export (JSON, CSV)
    [ ] Export full credit file as JSON (reversible, re-importable)
    [ ] Export tradeline/search/score data as CSV
    [ ] Export dashboard as printable HTML or PDF
[ ] Backup/restore tooling
    [ ] SQLite: file-level backup with VACUUM INTO for consistent snapshots
    [ ] Restore command with validation
[ ] Rate limiting on ingestion endpoint
[ ] Comprehensive error pages
[ ] Mobile-responsive layout
[ ] Performance optimization (pagination, lazy loading)
[ ] Accessibility audit (WCAG 2.1 AA)
[ ] End-to-end Playwright test suite
[ ] CI/CD pipeline (GitHub Actions)
    [ ] Lint + format check
    [ ] Type check (svelte-check + tsc)
    [ ] Unit tests (vitest)
    [ ] E2E tests (playwright)
    [ ] Docker build verification
    [ ] Automated release tagging
[ ] User documentation (setup guide, API guide, troubleshooting)
[ ] Data retention policies
    [ ] Configurable max age for raw artifacts
    [ ] Archive vs. delete semantics
    [ ] Compact old audit_log entries

================================================================================
FUTURE IDEAS (UNSCHEDULED)
================================================================================

- CLI tool for importing credit reports from command line
  (this is a key motivator for @ctview/core being framework-independent)
- Browser extension for scraping credit reports directly
- PDF parser adapter (Equifax statutory report)
- HTML scraper adapter (TransUnion via ClearScore)
- Notification system (email/webhook on score changes)
- Multi-subject support (household members)
- Plugin system for custom analysis
- Mobile app consuming the API (AD-007 ensures API is ready for this)
- Import diff view: side-by-side comparison showing what changed between
  two consecutive imports for the same subject (new tradelines, closed
  accounts, balance movements, score changes)
- GraphQL layer alongside REST (for clients that prefer it)
- Webhook system: push notifications to external URLs when anomalies are
  detected or new imports are processed
